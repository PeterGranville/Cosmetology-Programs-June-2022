---
title: "TCF Analysis of Cosmetology Programs"
author: "Peter Granville"
date: 'June 2022'
output: pdf_document
---

```{r setup, include=FALSE}
library(dplyr)
library(scales)
library(ggplot2)
library(stringr)
library(data.table)

#####################################################################
### This document reproduces The Century Foundation's June 2022   ###
### report on cosmetology programs, embedding the code used for   ###
### all original analysis into the text of the report. It is      ###
### intended for any user with proficiency in R to determine how  ###
### we calculated the figures in our report.                      ###
#####################################################################

#####################################################################
### This analysis relies on four data sources. Because the data   ###
### files are too large to have been stored on the GitHub         ###
### repository for this project, they must first be downloaded    ###
### before this code will successfully run.                       ###
#####################################################################

#####################################################################
### The first source is IPEDS, and all IPEDS .csv file names in   ###
### this document indicate the specific data file downloaded from ###
### the IPEDS online portal. The link is here:                    ### 
### https://nces.ed.gov/ipeds/datacenter/DataFiles.aspx?gotoReportId=7&fromIpeds=true&
#####################################################################

#####################################################################
### The next source is the College Scorecard. We use the full,    ###
### most recent (as of June 2022) program-level and               ###
### institution-level data sets, which can be downloaded here:    ###
### https://collegescorecard.ed.gov/data/. 
#####################################################################

#####################################################################
### The third file is the American Community Survey Public Use    ###
### Microdata Sample. We use the 1-year PUMS sample reflecting    ###
### calendar year 2019. The data files can be downloaded from     ###
### this site in the "csv_pus.zip" file:                          ###
### https://www2.census.gov/programs-surveys/acs/data/pums/2019/1-Year/
#####################################################################

#####################################################################
### Finally, we  use the data on Gainful Employment released in   ###
### March 2022 by the Department of Education. This is available  ###
### at the following link: https://www.newamerica.org/documents/7232/GE_Information_Rates_Data_03-15-22_FINAL.xlsx
#####################################################################

```

## Introduction 

This spring, the U.S. Department of Education announced that it was discharging the student loans of 28,000 students who attended Marinello Beauty School.  The department discharged the debts under a rule that wipes out the debts of students who were deceived by their school.  The action wiped out loans for all students, instead of limiting relief to students who applied for discharges.  The department extended broad relief because the school’s conduct affected all aspects of the program: the school misled students about the quality and content of programs; exploited students’ unpaid labor; failed to train students in key skills such as how to cut hair; and left students without the skills to pass certification exams, find employment, and repay their loans.     

For-profit cosmetology schools like Marinello have faced multiple actions from regulators as well as consumer class actions alleging deceptive practices, exploitation of unpaid labor, and other misconduct.  Unfortunately, the risks to cosmetology students extend beyond such illegal conduct.  Most programs require students to borrow student loans and invest nearly a year of their time in training, but lead to very meager benefits.  

```{r stat1, include=TRUE, echo=FALSE, warning=FALSE}
#####################################################################
### First we load the data from the institutional characteristics ###
### survey in IPEDS. The variables we use refer to the            ###
### institution's largest program.                                ###
#####################################################################

ic2020 <- read.csv("ic2020_py.csv", header=TRUE, row.names = NULL) %>% select(
  UNITID,   # Unique identification number of the institution
  CIPCODE1, # CIP code of largest program
  CIPCODE2, # CIP code of 2nd largest program
  CIPCODE3, # CIP code of 3rd largest program
  MTHCMP1,  # Number of months to complete largest program
  MTHCMP2,  # Number of months to complete 2nd largest program
  MTHCMP3   # Number of months to complete 3rd largest program
) 
ic2020$MTHCMP1 <- as.numeric(ic2020$MTHCMP1)
ic2020$MTHCMP2 <- as.numeric(ic2020$MTHCMP2)
ic2020$MTHCMP3 <- as.numeric(ic2020$MTHCMP3)

#####################################################################
### Now we define a list of cosmetology CIP codes, and we then    ###
### calculate the average length of time needed for a full-time   ###
### student to complete a cosmetology program.                    ###
#####################################################################

cosmetologyCIPs <- c(
  "12.0401",  # Cosmetology/Cosmetologist, General
  "12.0402",  # Barbering/Barber
  "12.0404",  # Electrolysis/Electrology and Electrolysis Technician
  "12.0406",  # Make-Up Artist/Specialist
  "12.0407",  # Hair Styling/Stylist and Hair Design
  "12.0408",  # Facial Treatment Specialist/Facialist
  "12.0409",  # Aesthetician/Esthetician and Skin Care Specialist
  "12.0410",  # Nail Technician/Specialist and Manicurist
  "12.041",   # Nail Technician/Specialist and Manicurist
  "12.0412",  # Salon/Beauty Salon Management/Manager
  "12.0413",  # Cosmetology, Barber/Styling, and Nail Instructor
  "12.0414",  # Master Aesthetician/Esthetician
  "12.0499")  # Cosmetology and Related Personal Grooming Arts, Other

ic1 <- ic2020 %>% filter(CIPCODE1 %in% cosmetologyCIPs)
ic2 <- ic2020 %>% filter(CIPCODE2 %in% cosmetologyCIPs)
ic3 <- ic2020 %>% filter(CIPCODE3 %in% cosmetologyCIPs)

ic1$ProgramLength <- ic1$MTHCMP1
ic2$ProgramLength <- ic2$MTHCMP2
ic3$ProgramLength <- ic3$MTHCMP3

ic1 <- ic1 %>% select(UNITID, ProgramLength) 
ic2 <- ic2 %>% select(UNITID, ProgramLength) 
ic3 <- ic3 %>% select(UNITID, ProgramLength) 

ic0 <- rbind(ic1, ic2, ic3)

average.months <- mean(ic0$ProgramLength, na.rm=TRUE)
paste("The average amount of full-time enrollment to complete a cosmetology program is ", round(average.months, 1), " months.", sep="")
```

The average cosmetologist earns $17,000 per year three years after completing their program, less than the median earnings of workers with only a high school diploma.  

```{r stat2A, include=TRUE, echo=FALSE, warning=FALSE}
#####################################################################
### Here we use the program-level College Scorecard dataset. We   ###
### filter for cosmetology programs and calculate the average     ###
### earnings of graduates.                                        ###
#####################################################################

CSP1 <- fread("Most-Recent-Cohorts-Field-of-Study.csv", header=TRUE, select=c(
  "UNITID",                  # Unit ID for institution
  "INSTNM",                  # Institution name
  "CIPCODE",                 # Classification of Instructional Programs (CIP) code for the field of study
  "EARN_COUNT_NE_3YR",       # Number of graduates not enrolled 3 years after completing highest credential
  "EARN_NE_MDN_3YR"          # Median earnings of graduates not enrolled 3 years after completing highest credential
)) %>% filter(CIPCODE == 1204)

CSP1$EARN_NE_MDN_3YR <- as.numeric(CSP1$EARN_NE_MDN_3YR)
CSP1$EARN_COUNT_NE_3YR <- as.numeric(CSP1$EARN_COUNT_NE_3YR)

CSP1 <- CSP1 %>% filter((is.na(EARN_NE_MDN_3YR)==FALSE) & (is.na(EARN_COUNT_NE_3YR)==FALSE))

#####################################################################
### We take the median values by program and weight them by the   ###
### program's share of cosmetology program graduates in the       ###
### cohort.                                                       ###
#####################################################################

CSP1$Share.of.cosmetology.grads <- CSP1$EARN_COUNT_NE_3YR / sum(CSP1$EARN_COUNT_NE_3YR, na.rm=TRUE)

CSP1$weighted.earnings <- CSP1$EARN_NE_MDN_3YR * CSP1$Share.of.cosmetology.grads

weighted.median.earnings <- sum(CSP1$weighted.earnings, na.rm=TRUE)
paste("Average earnings among cosmetology program graduates is ", dollar(weighted.median.earnings, accuracy=1), " 3 years post-completion.", sep="")
```

```{r stat2B, include=TRUE, echo=FALSE, warning=FALSE}

######################################################################
### This American Community Survey dataset reflects calendar year  ###
### 2019. We load in the weight variable and selected employment   ###
### and education variables. We filter for those who were in the   ###
### workforce at the time of interview.                            ###
######################################################################

######################################################################
### These datasets are too large to be published to the GitHub     ###
### repository. They can be accessed at the following site:        ###
### https://www2.census.gov/programs-surveys/acs/data/pums/2019/1-Year/
######################################################################

pumsVariables <- c(
  "SERIALNO", # Housing unit/GQ person serial number
  "PWGTP",    # Person weight
  "ADJINC",   # Adjustment factor for income and earnings dollar amounts (6 implied decimal places)
  "AGEP",     # Age
  "WAGP",     # Wages or salary income past 12 months
  "WKHP",     # Usual hours worked per week past 12 months
  "OCCP",     # Occupation recode
  "SCHL",     # Educational attainment
  "ESR")      # Employment status recode

pusa <- fread("psam_pusa_2019.csv", header=TRUE, select=pumsVariables) %>% filter(ESR %in% c(1, 2, 3, 4, 5))
pusb <- fread("psam_pusb_2019.csv", header=TRUE, select=pumsVariables) %>% filter(ESR %in% c(1, 2, 3, 4, 5))

######################################################################
### We now bind the two data sets and remove prior files.          ###
######################################################################

pusm <- rbind(pusa, pusb) 
rm("pusa", "pusb")

######################################################################
### Now we will filter for those with a high school diploma only,  ###
### aged 25-34 only, creating a new data frame.                    ###
######################################################################

pusm.HSG <- pusm %>% filter(SCHL %in% c(
  16, # Regular high school diploma
  17  # GED or alternative credential
)) %>% filter(AGEP %in% c(25, 26, 27, 28, 29, 30, 31, 32, 33, 34))

######################################################################
### We now derive the average earnings of high school graduates    ###
### (no further education) in the workforce. We take a weighted    ###
### average value.                                                 ###
######################################################################

pusm.HSG$PWGTPshare <- pusm.HSG$PWGTP / sum(pusm.HSG$PWGTP, na.rm=TRUE)
pusm.HSG$weighted.earnings <- pusm.HSG$PWGTPshare * pusm.HSG$WAGP

HSG.earnings <- sum(pusm.HSG$weighted.earnings, na.rm=TRUE)
paste("The average earnings of those with only a high school diploma (aged 25-34) is ", dollar(HSG.earnings, accuracy=1), ".", sep="")
```

In addition, cosmetology students graduate with an average of $10,200 in student loan debt.

```{r stat3, include=TRUE, echo=FALSE, warning=FALSE}

#####################################################################
### Similarly as in the estimate of average earnings by program,  ###
### we take the average debt values by program and weight them by ###
### the program's share of cosmetology program graduates in the   ###
### cohort.                                                       ###
#####################################################################

CSP2 <- fread("Most-Recent-Cohorts-Field-of-Study.csv", header=TRUE, select=c(
  "UNITID",                  # Unit ID for institution
  "INSTNM",                  # Institution name
  "CIPCODE",                 # Classification of Instructional Programs (CIP) code for the field of study
  "DEBT_ALL_STGP_EVAL_MEAN", # Average Stafford and Grad PLUS loan debt disbursed at this institution
  "DEBT_ALL_STGP_EVAL_N",    # Borrower count for average/median Stafford and Grad PLUS loan debt disbursed at this institution
  "DEBT_ALL_PP_EVAL_MEAN",   # Average Parent PLUS loan debt disbursed at this institution
  "DEBT_ALL_PP_EVAL_N"       # Student recipient count for average/median Parent PLUS loan debt disbursed at this institution
)) %>% filter(CIPCODE == 1204) 

CSP2$DEBT_ALL_STGP_EVAL_MEAN <- as.numeric(CSP2$DEBT_ALL_STGP_EVAL_MEAN)
CSP2$DEBT_ALL_PP_EVAL_MEAN <- as.numeric(CSP2$DEBT_ALL_PP_EVAL_MEAN)
CSP2$DEBT_ALL_STGP_EVAL_N <- as.numeric(CSP2$DEBT_ALL_STGP_EVAL_N)
CSP2$DEBT_ALL_PP_EVAL_N <- as.numeric(CSP2$DEBT_ALL_PP_EVAL_N)
CSP2 <- CSP2 %>% filter(is.na(DEBT_ALL_STGP_EVAL_N)==FALSE) %>% filter(is.na(DEBT_ALL_STGP_EVAL_MEAN)==FALSE)

CSP2$Share.of.STGP.recipients <- CSP2$DEBT_ALL_STGP_EVAL_N / sum(CSP2$DEBT_ALL_STGP_EVAL_N, na.rm=TRUE)
CSP2$Share.of.PP.recipients <- CSP2$DEBT_ALL_PP_EVAL_N / sum(CSP2$DEBT_ALL_PP_EVAL_N, na.rm=TRUE)

CSP2$weighted.STGP.debt <- CSP2$DEBT_ALL_STGP_EVAL_MEAN * CSP2$Share.of.STGP.recipients
CSP2$weighted.PP.debt <- CSP2$DEBT_ALL_PP_EVAL_MEAN * CSP2$Share.of.PP.recipients

weighted.average.STGP <- sum(CSP2$weighted.STGP.debt, na.rm=TRUE)
weighted.average.PP <- sum(CSP2$weighted.PP.debt, na.rm=TRUE)

paste("The average Stafford and Grad PLUS amount among cosmetology program graduates is ", dollar(weighted.average.STGP, accuracy=1), ".", sep="")
paste("The average Parent PLUS amount among cosmetology program graduates is ", dollar(weighted.average.PP, accuracy=1), ".", sep="")
```

Most cosmetology programs, which train hairdressers, makeup artists, and manicurists, are funded through federal student loans and grants.  Three-quarters of cosmetology programs are offered by for-profit companies.  

```{r stat4, include=TRUE, echo=FALSE, warning=FALSE}

#######################################################################
### We are interested here in the breakdown of cosmetology programs ###
### by sector. We use completion data to gather a list of           ###
### cosmetology programs. We then link this to institutional        ###
### control data and aggregate at the program level.                ###
#######################################################################

c2019 <- fread("c2019_a_rv.csv", header=TRUE, select=c(
  "UNITID",   # Unique identification number of the institution
  "CIPCODE",  # CIP Code -  2010 Classification
  "MAJORNUM", # First or Second Major
  "CTOTALT"   # Grand total
)) %>% filter(MAJORNUM==1) %>% filter(CIPCODE %in% cosmetologyCIPs) %>% filter(CTOTALT > 0)

hd2020 <- fread("hd2020.csv", header=TRUE, select=c(
  "UNITID",   # Unique identification number of the institution
  "CONTROL"   # Control of institution
))
c2019 <- right_join(x=hd2020, y=c2019, by="UNITID")
c2019$count <- rep(1, nrow(c2019))
agg1 <- aggregate(data=c2019, count ~ CONTROL, FUN=sum)

for.profit.share <- agg1$count[agg1$CONTROL==3] / sum(agg1$count)
paste("The share of cosmetology programs that are at for-profit colleges is ", percent(for.profit.share, accuracy=1), ".", sep="")
```

Most for-profit cosmetology schools have two primary revenue streams:  they collect federal loans and grants, and they generate profits from salon services that students provide to paying customers.  Cosmetology schools received more than $1 billion in federal loans and grants in 2019-20.  Unfortunately, the federal dollars invested in these institutions have not translated into adequate earnings for program graduates. 

```{r stat5, include=TRUE, echo=FALSE, warning=FALSE}

#######################################################################
### We are interested here in the total federal student aid at      ###
### cosmetology schools. We must first define what is a cosmetology ###
### school: for this report, we define it as one where half of all  ###
### programs in 2018-19 are in cosmetology. We rely here on         ###
### IPEDS data on annual award completions. We use 2018-19 instead  ###
### of 2019-20 to avoid any irregularities caused by COVID-19.      ###
#######################################################################

c2019 <- fread("c2019_a_rv.csv", header=TRUE, select=c(
  "UNITID",   # Unique identification number of the institution
  "CIPCODE",  # CIP Code -  2010 Classification
  "AWLEVEL",  # Award Level code
  "MAJORNUM", # First or Second Major
  "CTOTALT",  # Grand total 
  "CTOTALW",  # Grand total women
  "CBKAAT",   # Black or African American total
  "CHISPT"    # Hispanic or Latino total
)) %>% filter(MAJORNUM==1) %>% filter(CTOTALT > 0) # This prevents over-counting of programs.

#######################################################################
### Now we count the number of programs that are in cosmetology.    ###
#######################################################################

c2019$Cosmetology <- ifelse(c2019$CIPCODE %in% cosmetologyCIPs, 1, 0)
c2019$Counter <- rep(1, nrow(c2019))

agg2 <- aggregate(data=c2019, cbind(Cosmetology, Counter) ~ UNITID, FUN=sum)
agg2$`Cosmetology share` <- agg2$Cosmetology / agg2$Counter
agg3 <- agg2 %>% filter(`Cosmetology share` >= 0.5)
cosmetologySchools <- unique(agg3$UNITID)

#######################################################################
### We now have a list of institutions that we have identified as   ###
### cosmetology schools. Next we derive cosmetology schools' total  ###
### federal grants and loans in 2019-20.                            ###
#######################################################################

sfa1920 <- fread("sfa1920.csv", header=TRUE, select=c(
  "UNITID", 
  "UFLOANT", 
  "UPGRNTT"
))
hd2020 <- fread("hd2020.csv", header=TRUE, select=c(
  "UNITID", 
  "CONTROL"
))
total.aid <- sum(sfa1920$UFLOANT[sfa1920$UNITID %in% cosmetologySchools], na.rm=TRUE) + sum(sfa1920$UPGRNTT[sfa1920$UNITID %in% cosmetologySchools], na.rm=TRUE)

paste("Total federal student aid received by cosmetology schools in 2019-20 was ", dollar(total.aid, accuracy=1000000), ".", sep="") # Rounded to the nearest million.
```

Women and people of color make up a disproportionate share of cosmetology graduates.  More than 90% of cosmetology program graduates are women.  

```{r stat6, include=TRUE, echo=FALSE, warning=FALSE}

#######################################################################
### For this and the next set of stats, we use the completions      ###
### dataframe we had just used.                                     ###
#######################################################################

cosmoGrads <- c2019 %>% filter(Cosmetology==1)
female.share <- sum(cosmoGrads$CTOTALW, na.rm=TRUE) / sum(cosmoGrads$CTOTALT, na.rm=TRUE)
paste("The share of cosmetology credential earners who are women is ", percent(female.share), ".", sep="")
```

Black and Latino/a students also receive an outsized share of cosmetology credentials:  Black students receive 19 percent of cosmetology certification awards but comprise 12 percent of the postsecondary student population, and Latino/a students receive 24 percent of cosmetology awards but comprise 19 percent of the student population.  

```{r stat7, include=TRUE, echo=FALSE, warning=FALSE}

#######################################################################
### First we find the shares of Black and Latino/a cosmetology      ###
### credential earners.                                             ###
#######################################################################

Black.share.1 <- sum(cosmoGrads$CBKAAT, na.rm=TRUE) / sum(cosmoGrads$CTOTALT, na.rm=TRUE)
Latino.share.1 <- sum(cosmoGrads$CHISPT, na.rm=TRUE) / sum(cosmoGrads$CTOTALT, na.rm=TRUE)
paste(percent(Black.share.1, accuracy=0.1), " of cosmetology credential earners are Black. ", percent(Latino.share.1, accuracy=0.1), " are Latino or Hispanic.", sep="")

#######################################################################
### Next we do the same for all postsecondary enrollment.           ###
#######################################################################

effy2019 <- fread("effy2019_rv.csv", header=TRUE, select=c(
  "UNITID",   # Unique identification number of the institution
  "EFFYLEV",  # Level of student
  "EFYTOTLT", # Grand total
  "EFYBKAAT", # Black or African American total
  "EFYHISPT"  # Hispanic or Latino total
)) %>% filter(EFFYLEV==1)

Black.share.2 <- sum(effy2019$EFYBKAAT, na.rm=TRUE) / sum(effy2019$EFYTOTLT, na.rm=TRUE)
Latino.share.2 <- sum(effy2019$EFYHISPT, na.rm=TRUE) / sum(effy2019$EFYTOTLT, na.rm=TRUE)
paste(percent(Black.share.2, accuracy=0.1), " of all postsecondary students are Black. ", percent(Latino.share.2, accuracy=0.1), " are Latino or Hispanic.", sep="")
```

Most cosmetology students also tend to be low-income when they enroll:  54 percent of students who attend cosmetology schools receive federal Pell grants, which are available to low-income students, compared with just 34 percent in all programs.   

```{r stat8, include=TRUE, echo=FALSE, warning=FALSE}

########################################################################
### Here we rely on the list of cosmetology schools derived earlier. ###
### First we find the share of undergraduates at cosmetology schools ###
### who receive Pell.                                                ###
########################################################################

sfa1 <- fread("sfa1920.csv", header=TRUE, select=c(
  "UNITID", 
  "UPGRNTN", # Number of undergraduate students awarded Pell grants
  "SCUGRAD"    # Total number of undergraduates - financial aid cohort
)) %>% filter(UNITID %in% cosmetologySchools)
sfa1$UPGRNTN <- as.numeric(sfa1$UPGRNTN)
sfa1$SCUGRAD <- as.numeric(sfa1$SCUGRAD)
pell.at.cosmetology.schools <- sum(sfa1$UPGRNTN, na.rm=TRUE) / sum(sfa1$SCUGRAD, na.rm=TRUE)

########################################################################
### Now we do the same again, without applying the filter for        ###
### cosmetology schools.                                             ###
########################################################################

sfa2 <- fread("sfa1920.csv", header=TRUE, select=c(
  "UNITID", 
  "UPGRNTN", # Number of undergraduate students awarded Pell grants
  "SCUGRAD"    # Total number of undergraduates - financial aid cohort
)) 
sfa2$UPGRNTN <- as.numeric(sfa2$UPGRNTN)
sfa2$SCUGRAD <- as.numeric(sfa2$SCUGRAD)
pell.at.all.schools <- sum(sfa2$UPGRNTN, na.rm=TRUE) / sum(sfa2$SCUGRAD, na.rm=TRUE)

paste("The share of cosmetology school undergraduates receiving Pell is ", percent(pell.at.cosmetology.schools, accuracy=0.1), ".", sep="")
paste("The share of all undergraduates receiving Pell is ", percent(pell.at.all.schools, accuracy=0.1), ".", sep="")
```

This summer, the Department of Education is expected to propose a new federal rule that will impose minimum standards on cosmetology and other career-focused postsecondary programs that receive federal funding.  The rule, referred to as the “Gainful Employment rule,” will tie programs’ eligibility for federal Title IV funding to minimum outcome standards, including measures of graduates’ debt in relation to their earnings and measures of graduates’ earnings in comparison to workers with only a high school diploma.  The earnings threshold sets an extremely low bar:  programs will fail only if graduates earn, on average, less than the average high school graduate earns in their state. Programs that do not raise graduates' earnings above the level of high school graduates do not provide a significant benefit to students and do not merit taxpayer investment.  The Gainful Employment rule’s earnings threshold will ensure that such programs do not remain eligible for federal funding.

Although the rule sets a low bar for program outcomes, a shockingly high proportion of cosmetology programs will fail the benchmarks: as many as 98 percent of cosmetology programs subject to the rule would fail the high school earnings test, and as many as 28 percent of cosmetology programs subject to the rule would fail the debt-to-earnings test.  (See Table 1 below.)     

```{r table1, include=TRUE, echo=FALSE, warning=FALSE}

#######################################################################
### First we load in the Education Department's dataset, published  ###
### in March 2022. Then we mark which programs are cosmetology      ###
### program and which are subject to each test.                     ###
#######################################################################

GE <- read.csv("GE_Information_Rates_Data_03-15-22_FINAL.csv", header=TRUE)
GE$count <- rep(1, nrow(GE))
GE$failsDTE <- ifelse(GE$pfDTE=="Fail - based on GE Data", 1, 0)
GE$failsET <- ifelse(GE$pfET=="Fail - based on GE Data", 1, 0)
GE$totalFails <-GE$failsDTE + GE$failsET

GEP <- GE %>% filter(geprogram==1)
GEP$`Number of tests subject to` <- GEP$inDTE + GEP$inET

GEP.DTE <- GE %>% filter(inDTE==1)
GEP.ET <- GE %>% filter(inET==1)

GEP.cos <- GEP %>% filter(cipcode==1204)
GEP.cos.DTE <- GEP.cos %>% filter(inDTE==1)
GEP.cos.ET <- GEP.cos %>% filter(inET==1)
GEP.cos.BOTH <- GEP.cos %>% filter(`Number of tests subject to`==2)

#######################################################################
### First we establish the table with the for-profit row added.     ###
#######################################################################

table1 <- data.frame("Control"=c("For-profit"), 
                     "Programs subject to both tests"=c(sum(GEP.cos.BOTH$count[GEP.cos.BOTH$control=="Private, for-profit"])), 
                     "Programs that fail DTE test"=c(sum(GEP.cos.BOTH$count[(GEP.cos.BOTH$control=="Private, for-profit") & (GEP.cos.BOTH$failsDTE==1)])), 
                     "Programs that fail ET test"=c(sum(GEP.cos.BOTH$count[(GEP.cos.BOTH$control=="Private, for-profit") & (GEP.cos.BOTH$failsET==1)])), 
                     "Programs that fail at least one test"=c(sum(GEP.cos.BOTH$count[(GEP.cos.BOTH$control=="Private, for-profit") & (GEP.cos.BOTH$totalFails >= 1)])), 
                     "Programs that fail both tests"=c(sum(GEP.cos.BOTH$count[(GEP.cos.BOTH$control=="Private, for-profit") & (GEP.cos.BOTH$totalFails == 2)])))

#######################################################################
### Next we add the row for nonprofits.                             ###
#######################################################################

table1 <- table1 %>% add_row(Control="Nonprofit", 
                     Programs.subject.to.both.tests=sum(GEP.cos.BOTH$count[GEP.cos.BOTH$control=="Private, nonprofit"]), 
                     Programs.that.fail.DTE.test=sum(GEP.cos.BOTH$count[(GEP.cos.BOTH$control=="Private, nonprofit") & (GEP.cos.BOTH$failsDTE==1)]), 
                     Programs.that.fail.ET.test=sum(GEP.cos.BOTH$count[(GEP.cos.BOTH$control=="Private, nonprofit") & (GEP.cos.BOTH$failsET==1)]), 
                     Programs.that.fail.at.least.one.test=sum(GEP.cos.BOTH$count[(GEP.cos.BOTH$control=="Private, nonprofit") & (GEP.cos.BOTH$totalFails >= 1)]), 
                     Programs.that.fail.both.tests=sum(GEP.cos.BOTH$count[(GEP.cos.BOTH$control=="Private, nonprofit") & (GEP.cos.BOTH$totalFails == 2)]))

#######################################################################
### Now we add a row for publics.                                   ###
#######################################################################

table1 <- table1 %>% add_row(Control="Public", 
                     Programs.subject.to.both.tests=sum(GEP.cos.BOTH$count[GEP.cos.BOTH$control=="Public"]), 
                     Programs.that.fail.DTE.test=sum(GEP.cos.BOTH$count[(GEP.cos.BOTH$control=="Public") & (GEP.cos.BOTH$failsDTE==1)]), 
                     Programs.that.fail.ET.test=sum(GEP.cos.BOTH$count[(GEP.cos.BOTH$control=="Public") & (GEP.cos.BOTH$failsET==1)]), 
                     Programs.that.fail.at.least.one.test=sum(GEP.cos.BOTH$count[(GEP.cos.BOTH$control=="Public") & (GEP.cos.BOTH$totalFails >= 1)]), 
                     Programs.that.fail.both.tests=sum(GEP.cos.BOTH$count[(GEP.cos.BOTH$control=="Public") & (GEP.cos.BOTH$totalFails == 2)]))

#######################################################################
### Lastly we add a row for all institutions regardless of control. ###
#######################################################################

table1 <- table1 %>% add_row(Control="Total", 
                     Programs.subject.to.both.tests=sum(GEP.cos.BOTH$count), 
                     Programs.that.fail.DTE.test=sum(GEP.cos.BOTH$count[GEP.cos.BOTH$failsDTE==1]), 
                     Programs.that.fail.ET.test=sum(GEP.cos.BOTH$count[GEP.cos.BOTH$failsET==1]), 
                     Programs.that.fail.at.least.one.test=sum(GEP.cos.BOTH$count[GEP.cos.BOTH$totalFails >= 1]), 
                     Programs.that.fail.both.tests=sum(GEP.cos.BOTH$count[GEP.cos.BOTH$totalFails == 2]))

#######################################################################
### Now we add in percentages to show the share of programs that    ###
### fall into each category.                                        ###
#######################################################################

table1$Programs.that.fail.DTE.test <- paste(table1$Programs.that.fail.DTE.test, " (", percent(table1$Programs.that.fail.DTE.test / table1$Programs.subject.to.both.tests, accuracy=1), ")", sep="")

table1$Programs.that.fail.ET.test <- paste(table1$Programs.that.fail.ET.test, " (", percent(table1$Programs.that.fail.ET.test / table1$Programs.subject.to.both.tests, accuracy=1), ")", sep="")

table1$Programs.that.fail.at.least.one.test <- paste(table1$Programs.that.fail.at.least.one.test, " (", percent(table1$Programs.that.fail.at.least.one.test / table1$Programs.subject.to.both.tests, accuracy=1), ")", sep="")

table1$Programs.that.fail.both.tests <- paste(table1$Programs.that.fail.both.tests, " (", percent(table1$Programs.that.fail.both.tests / table1$Programs.subject.to.both.tests, accuracy=1), ")", sep="")

#######################################################################
### Finally we adjust the column names and print the table.         ###
#######################################################################

names(table1) <- c("Control", "Programs subject to both tests", "Programs that fail DTE test", "Programs that fail ET test", "Programs that fail at least one test", "Programs that fail both tests")
table1

```

Programs that fail either of the metrics for more than two out of three years will lose eligibility for Title IV funding for a period of three years.  These programs will be forced to find other funding sources, or close their doors.  While the new Gainful Employment rule will test the resilience of the industry, it will provide significant and much-needed protections for students.

## Why are cosmetology programs such a bad deal for students?

### State licensure requirements contribute to the high cost of cosmetology programs

State licensure requirements are a primary driver for the high cost of cosmetology programs.  All 50 states require cosmetologists to obtain licensure, and all impose a minimum number of training hours as a requirement for licensure.  The licensure requirements are imposed, at least in part, to address public health and safety concerns associated with provision of cosmetology services.  Longer training hour requirements also benefit for-profit cosmetology schools, which can charge higher tuition for longer programs, and industry professionals, who benefit from regulatory hurdles that make it harder for competitors to enter the field.  Lobbying groups representing these interests play a role in driving up licensing requirements by pressuring state lawmakers to raise entry requirements. 

Training hour requirements for cosmetologists vary widely, from 1,000-hour requirements in Massachusetts and New York, to more than double that number in Iowa, Oregon, and South Dakota.  In many cases, the minimum training hour requirements exceed training hour requirements for professions that may pose greater public health and safety risks than cosmetology.  For example, cosmetologists must complete, on average, 11 times as much training as the average emergency medical technician (EMT).  This suggests that cosmetologists’ minimum training hour requirements may be unnecessarily inflated. 

If longer programs led to better graduate outcomes or other benefits, presumably a substantial number of programs would exceed state minimum hour requirements. However, the evidence indicates that the state requirements are causing excessively lengthy training: a report by the Institute for Justice found that more than 95 percent of cosmetology programs’ lengths exactly matched the number of hours of education required for state licensure in cosmetology in the schools’ state.  In addition, when states lower training hour requirements, cosmetology schools generally shorten their program lengths to reflect the reduced requirements. 

Unsurprisingly, longer training hour requirements result in higher costs and higher student loan debt for cosmetology students.   Reducing training requirements would enable schools to offer shorter, more affordable programs, reducing cosmetology students’ costs and debt burdens.
 
While the Department of Education does not directly control states’ licensing requirements, the department has a plan to use Title IV eligibility requirements to indirectly influence state licensing requirements.  The department is expected to propose a rule that would create an incentive for states to reduce inflated hours requirements by limiting Title IV eligibility based on the length of programs.  The proposed rule provides that where the majority of states have licensure requirements for an occupation, Title IV funding eligibility will be limited to the portion of the program that falls below the national median of the minimum number of training hours required for licensure.  For cosmetology, the national median number of hours required for licensure is 1500.  In states with requirements above the median, students would not be eligible for Title IV funding after completing 1500 training hours.    

The proposed rule would create an incentive for-profit cosmetology schools to lobby for decreases in state licensing hour requirements in states where the minimum hours required for licensure exceeds the national median.  Such efforts could lead state lawmakers in those states to reduce state licensure requirements, resulting in lower-cost programs and reductions in student debt loads for cosmetology programs in those states. 

### Cosmetology schools benefit from students’ unpaid labor

In addition to revenue from federal loans, grants, and out-of-pocket payments from students, many cosmetology schools receive revenue from students’ unpaid work providing salon services such as haircuts, manicures, and facials, to paying customers.  Students may also be required to complete cleaning or administrative duties, and to sell products to customers.    

In some states, including New York, cosmetology students have successfully sued their school to enforce their right to payment for at least some types of labor provided while enrolled in cosmetology programs.  However, courts in other states have held that cosmetology students are not entitled to employment protections for labor provided as part of cosmetology training, even when that labor involves tasks that include tasks that are not directly related to cosmetology skills, such as cleaning or administrative tasks.  

State lawmakers could expand protections to cosmetology students by enacting legislation that extends state worker protections to students who provide services to paying customers as part of their training.  The Department of Education could also consider imposing limitations on unpaid labor by students enrolled in Title IV funded programs.    

## A new federal rule would prevent students and taxpayers from investing in low-value programs

This summer, the U.S. Department of Education is expected to propose a new version of the Gainful Employment rule.  The Gainful Employment rule was enacted by the Obama Administration in 2014 but later rescinded by the Trump Administration. The rule applied to programs offered by for-profit colleges and to non-degree career-training programs offered by nonprofit and public colleges.  The Gainful Employment rule conditioned eligibility for federal funding on a program meeting a debt-to-earnings benchmark.   

The department’s proposed rule is expected to be released this summer for public comment.  The department has signaled that it plans to reinstate the debt-to-earnings metric that was part of the prior version of the rule, with a few changes.  The new rule is expected to include a new, additional benchmark:  an “earnings threshold” that will limit eligibility for federal funds to programs that demonstrate that typical program graduates earn more than the average worker who has only a high school diploma. The rationale for applying an earning threshold is compelling.  Postsecondary programs that do not raise graduates’ earnings above the level of high school graduates are not providing a significant benefit to students and do not merit the investment of taxpayer dollars.   

Including both a debt-to-earnings and a high school earnings threshold in the new rule is necessary to protect students and taxpayers from investing in programs that leave students unable to pay back their loans or earning poverty-level wages.  Some low-value programs pass the debt-to-earnings metric because of low borrowing rates among students, but fail the high school earnings metric because most graduates earn poverty-level wages.  Including both metrics will capture both types of these low-value programs and ensure that the programs do not receive taxpayer dollars.

As many as 98 percent of cosmetology programs that are subject to the rule fail the earnings threshold according to current data.

```{r stat9, include=TRUE, echo=FALSE, warning=FALSE}

#######################################################################
### Here we simply divide the number of cosmetology programs that   ###
### fail the earnings threshold test by the total number of         ###
### cosmetology programs subject to the test.                       ###
#######################################################################

et.fail.percent <- sum(GEP.cos.BOTH$failsET) / sum(GEP.cos.BOTH$count)
paste("The share of cosmetology programs that fail the earnings threshold test is ", percent(et.fail.percent, accuracy=0.1), ".", sep="")
```

In fact, cosmetology programs comprise 25 percent of all types of programs that fail the high school earnings threshold, even though cosmetology programs make up only 16 percent of all programs subject to rule.  

```{r stat10, include=TRUE, echo=FALSE, warning=FALSE}

#######################################################################
### First we aggregate and derive the totals we need.               ###
#######################################################################

agg5 <- aggregate(data=GEP.ET, count ~ failsET + cipcode, FUN=sum)

cosmetology.programs.in.ET <- sum(agg5$count[agg5$cipcode==1204])
all.programs.in.ET <- sum(agg5$count, na.rm=TRUE)

cosmetology.ET.fails <- sum(agg5$count[(agg5$cipcode==1204) & (agg5$failsET==1)])
all.ET.fails <- sum(agg5$count[agg5$failsET==1], na.rm=TRUE)

#######################################################################
### Now we divide the total number of cosmetology programs that     ###
### fail ET by the total number of programs that fail ET.           ###
#######################################################################

paste("Cosmetology programs comprise ", percent(cosmetology.ET.fails / all.ET.fails), " of all ET failures.", sep="")

#######################################################################
### Next we divide the total number of cosmetology programs subject ###
### to ET by the total number of programs subject to ET.            ###
#######################################################################

paste("Cosmetology programs comprise ", percent(cosmetology.programs.in.ET / all.programs.in.ET), " of all programs subject to the ET test.", sep="")
```

Of the failing cosmetology programs, 89 percent are offered by for-profit schools, while for-profit schools comprise 70 percent of programs subject to the rule. 

```{r stat11, include=TRUE, echo=FALSE, warning=FALSE}

#######################################################################
### First we aggregate and derive the totals we need.               ###
#######################################################################

agg6 <- aggregate(data=GEP.ET, count ~ failsET + cipcode + control, FUN=sum)

ET.fail.cosmos.FP <- sum(agg6$count[(agg6$cipcode==1204) & (agg6$control=="Private, for-profit") & (agg6$failsET==1)])
ET.fail.cosmos <- sum(agg6$count[(agg6$cipcode==1204) & (agg6$failsET==1)])

ET.all.FP <- sum(agg6$count[agg6$control=="Private, for-profit"])
ET.all <- sum(agg6$count)

#######################################################################
### Here we divide the total number of ET-failing cosmetology       ###
### programs by the total number of ET-failing programs.            ###
#######################################################################

paste("For-profit colleges comprise ", percent(ET.fail.cosmos.FP / ET.fail.cosmos), " of ET failures.", sep="")

#######################################################################
### Now we divide the total number of for-profit programs subject   ###
### to ET by the total number of programs subject to ET.            ###
#######################################################################

paste("For-profit colleges comprise ", percent(ET.all.FP / ET.all), " of all programs subject to the ET test.", sep="")
```

```{r figure1, include=TRUE, echo=FALSE, warning=FALSE}

#######################################################################
### This uses the dataset of cosmetology GE programs subject to ET. ###
### We start by modifying how ET passes and failures are indicated  ###
### (purely for aesthetics). Then we make a scatterplot that maps   ###
### program earnings to the relevant state earnings threshold.      ###
#######################################################################

GEP.cos.ET$`Pass/Fail` <- ifelse(GEP.cos.ET$pfET=="Fail - based on GE Data", "Fail", "Pass")
fig1 <- ggplot(data=GEP.cos.ET, mapping=aes(x=state_mdincearn_lf, y=earn_ne_mdn_3yr)) + geom_point(aes(shape=`Pass/Fail`), alpha=0.6, size=3) 

#######################################################################
### Now we add a line indicating the threshold programs must cross  ###
### to pass the test.                                               ###
#######################################################################

fig1 <- fig1 + geom_abline(slope=1, intercept=0, color="red", linetype="dashed") 

#######################################################################
### Finally we perform some formatting and print the figure.        ###
#######################################################################

fig1 <- fig1 + scale_y_continuous(labels=scales::dollar_format()) + labs(y="Median earnings of graduates after 3 years", caption="Programs located under the red line fail the earnings threshold test") + scale_shape_manual(values = c(4, 1)) + scale_x_continuous(name = str_wrap("Median earnings for a H.S. graduate (age 25-34) in the state where the institution is located, who were in the labor force or had positive earnings", width = 80), labels=scales::dollar_format())

fig1
```

In Figure 1 above, all programs located below the red line fail the earnings threshold test. Nearly all cosmetology programs with sufficient data for assessment fail the test, and many fail by a large margin. 

Critics of the high school earnings metric have suggested that the metric is not an appropriate method for evaluating cosmetology program outcomes.  These arguments are considered below. 


### Underreported earnings affect cosmetology programs’ failure rates.

Cosmetology schools have argued that applying an earnings-based metric to cosmetology programs is unfair because cosmetologists receive a significant portion of their earnings as tipped income, and this income is underreported to tax authorities, which are the source of the data used to calculate earnings outcomes.  While the 2014 Gainful Employment rule permitted schools with failing programs to appeal earnings rate determinations by submitting data from institutional surveys of schools’ graduates, the department has indicated that the new rule will not provide for such an appeals process.    

In a recent report, scholars extrapolate from IRS findings on underreported income to estimate that approximately 8 percent of cosmetologist’s income is not reported to tax authorities.  The scholars conclude that adjusting cosmetology programs’ earnings data to include the estimated unreported earnings would not substantially change the failure rates for cosmetology programs under the debt-to-earnings threshold of the 2014 Gainful Employment Rule.  

Using the most recent data, an 8 percent adjustment would result in a 22 percent failure rate for the cosmetology programs under the debt-to-earnings metric, compared to a 28 percent failure rate without any adjustment.  

```{r stat12, include=TRUE, echo=FALSE, warning=FALSE}

#######################################################################
### Here we make a branch of the dataset with cosmetology programs  ###
### that are subject to the DTE test.                               ###
#######################################################################

GEP.cos.DTE.test <- GEP.cos.DTE

#######################################################################
### Next we inflate earnings by 8%.                                 ###
#######################################################################

GEP.cos.DTE.test$earn_ne_mdn_3yr <- GEP.cos.DTE.test$earn_ne_mdn_3yr * 1.08

#######################################################################
### Now we replicate the DTE test. It starts with a discretionary   ###
### earnings rate: the percentage of a GE program’s annual loan     ###
### payment [annual_loan_payment_plus] compared to the              ###
### discretionary earnings of the students who completed the        ###
### program [earn_ne_mdn_3yr - 18735].                              ###
#######################################################################

GEP.cos.DTE.test$disc.earnings.rate <- GEP.cos.DTE.test$annual_loan_payment_plus / (GEP.cos.DTE.test$earn_ne_mdn_3yr - 18735)

#######################################################################
### Next we create a variable for the annual earnings rate: the     ###
### ratio of a GE program’s typical annual loan payment amount      ###
### [annual_loan_payment_plus] compared to the typical annual       ###
### earnings of the students who completed the program              ###
### [earn_ne_mdn_3yr], expressed as a percentage.                   ###
#######################################################################

GEP.cos.DTE.test$annual.earnings.rate <- GEP.cos.DTE.test$annual_loan_payment_plus / GEP.cos.DTE.test$earn_ne_mdn_3yr

#######################################################################
### Now we assign failures to any program where (i) Its             ###
### discretionary earnings rate is greater than 20 percent or the   ###
### income for the denominator of the rate (median discretionary    ###
### earnings) is negative or zero and the numerator (median debt    ###
### payments) is positive; and (ii) Its annual earnings rate is     ###
### greater than 8 percent or the denominator of the rate (median   ###
### annual earnings) is zero and the numerator (median debt         ###
### payments) is positive.                                          ###
####################################################################### 

GEP.cos.DTE.test$pfDTE.modified <- ifelse(((GEP.cos.DTE.test$disc.earnings.rate > 0.2
                                           |
                                           ((GEP.cos.DTE.test$earn_ne_mdn_3yr - 18735) <= 0
                                            &
                                            GEP.cos.DTE.test$annual_loan_payment_plus > 0
                                           ))
                                          &
                                          (GEP.cos.DTE.test$annual.earnings.rate > 0.08
                                            |
                                            ((GEP.cos.DTE.test$earn_ne_mdn_3yr == 0)
                                            &
                                            (GEP.cos.DTE.test$annual_loan_payment_plus > 0)
                                          ))), 
                                          "Fail", "Pass")

####################################################################### 
### Now we simply count fails as a percentage of all programs.      ###
####################################################################### 

modified.DTE.fails <- sum(GEP.cos.DTE.test$count[GEP.cos.DTE.test$pfDTE.modified=="Fail"])
modified.DTE.n <- sum(GEP.cos.DTE.test$count)

paste("With an 8% earnings adjustment, ", percent(modified.DTE.fails / modified.DTE.n), " of programs fail DTE.", sep="")
paste("The unmodified DTE fail rate, 28%, came from Table 1.")

```

Similarly, an adjustment for unreported earnings would not result in a substantial change in the failure rate under the high school earnings threshold.  An 8 percent adjustment would result in a 95 percent failure rate for cosmetology programs under the high school earnings threshold, compared to a 98 percent failure rate without the adjustment.  

```{r stat13, include=TRUE, echo=FALSE, warning=FALSE}

####################################################################### 
### Here we branch the dataset of cosmetology GE programs that are  ###
### subject to the earnings threshold test.                         ###
####################################################################### 

GEP.cos.ET.test <- GEP.cos.ET

####################################################################### 
### Now we inflate earnings by 8%.                                  ###
####################################################################### 

GEP.cos.ET.test$earn_ne_mdn_3yr <- GEP.cos.ET.test$earn_ne_mdn_3yr * 1.08

####################################################################### 
### Next we recreate the pass/fail determination.                   ###
####################################################################### 

GEP.cos.ET.test$pfET.modified <- ifelse(GEP.cos.ET.test$earn_ne_mdn_3yr > GEP.cos.ET.test$state_mdincearn_lf, 
                                        "Pass", "Fail")

####################################################################### 
### Finally we count fails as a percentage of programs.             ###
####################################################################### 

modified.ET.fails <- sum(GEP.cos.ET.test$count[GEP.cos.ET.test$pfET.modified=="Fail"])
modified.ET.n <- sum(GEP.cos.ET.test$count) 

paste("With an 8% earnings adjustment, ", percent(modified.ET.fails / modified.ET.n), " of programs fail ET.", sep="")

####################################################################### 
### Now we quickly derive the unadjusted passing share.             ###
####################################################################### 

fail.share.ET <- sum(GEP.cos.ET$count[GEP.cos.ET$pfET=="Fail - based on GE Data"]) / sum(GEP.cos.ET$count)
paste("Without an adjustment, ", percent(fail.share.ET), " of cosmetology programs subject to the ET rule fail.")
```

Although the adjustment for unreported income does not make a large difference in cosmetology program failure rates under either benchmark, the department might want to consider adjusting for unreported income to address fairness concerns.   

### Part-time work schedules are not a root cause of cosmetology programs’ failure rates

Critics of applying the debt-to-earnings and high school earnings thresholds to cosmetology programs have also suggested that earnings-based metrics are unfair to cosmetology programs because cosmetology students include many women and single parents who seek to work part-time schedules.  If cosmetology students do in fact work significantly fewer hours than the typical worker, that would depress cosmetology programs’ earnings outcomes.  However, data from the American Community Survey shows that cosmetologists typically work close to a full-time schedule:  cosmetologists work an average of 33.5 hours per week, compared to a typical work week of 38.2 hours per week for other workers.  

```{r stat14, include=TRUE, echo=FALSE, warning=FALSE}

######################################################################
### Here we take the ACS dataframe we had been previously working  ###
### with and create one dataframe for cosmetologists only and      ###
### another for non-cosmetologist workers.                         ###
######################################################################

cosmetologyOCCPs <- c(
  4500, # Barbers
  4510, # Hairdressers, Hairstylists, And Cosmetologists
  4521, # Manicurists And Pedicurists
  4522, # Skincare Specialists
  4525  # Other Personal Appearance Workers
)
pusm.cos <- pusm %>% filter(OCCP %in% cosmetologyOCCPs)
pusm.nocos <- pusm %>% filter((OCCP %in% cosmetologyOCCPs)==FALSE)

######################################################################
### Now we derive the mean weekly hours worked, weighted by PWGTP. ###
######################################################################

pusm.cos$PWGTPshare <- pusm.cos$PWGTP / sum(pusm.cos$PWGTP, na.rm=TRUE)
pusm.cos$weighted.earnings <- pusm.cos$PWGTPshare * pusm.cos$WKHP
mean.cosmetologist.hours <- sum(pusm.cos$weighted.earnings, na.rm=TRUE)

pusm.nocos$PWGTPshare <- pusm.nocos$PWGTP / sum(pusm.nocos$PWGTP, na.rm=TRUE)
pusm.nocos$weighted.earnings <- pusm.nocos$PWGTPshare * pusm.nocos$WKHP
mean.noncosmetologist.hours <- sum(pusm.nocos$weighted.earnings, na.rm=TRUE)

paste("Cosmetologists work an average of ", round(mean.cosmetologist.hours, 1), " hours per week.")
paste("All other workers work an average of ", round(mean.noncosmetologist.hours, 1), " hours per week.")
```

Even if a 14 percent adjustment were made to programs’ median income data to account for this 3.3-hour gap, more than 9 in 10 cosmetology programs would still fail the high school earnings threshold test. This suggests that part time work schedules are not the root cause of the poor outcomes of cosmetology programs.  

```{r stat15, include=TRUE, echo=FALSE, warning=FALSE}

######################################################################
### This is the same process as we had used for the previous       ###
### earnings adjustment (see the "stat14" chunk).                  ###
######################################################################

GEP.cos.ET.test2 <- GEP.cos.ET
GEP.cos.ET.test2$earn_ne_mdn_3yr <- GEP.cos.ET.test2$earn_ne_mdn_3yr * 1.095
GEP.cos.ET.test2$pfET.modified <- ifelse(GEP.cos.ET.test2$earn_ne_mdn_3yr > GEP.cos.ET.test2$state_mdincearn_lf, 
                                        "Pass", "Fail")
modified.ET.2.fails <- sum(GEP.cos.ET.test2$count[GEP.cos.ET.test2$pfET.modified=="Fail"])
modified.ET.2.n <- sum(GEP.cos.ET.test2$count) 
paste("With a 9.5% earnings adjustment, ", percent(modified.ET.fails / modified.ET.n), " of programs fail ET.", sep="")
```

### Gender-based wage disparities are not the primary cause of cosmetology programs’ failure rates.

Some have argued that the high proportion of women in cosmetology programs and gender-based wage disparities could also contribute to the low earnings outcomes of cosmetology programs.  More than 90 percent of cosmetology students are women.  

```{r stat16, include=TRUE, echo=FALSE, warning=FALSE}
paste("This was calculated earlier in the paper.")
```

In contrast, men are disproportionately represented in the general workforce - men make up around 61 percent of working 25 – 34 year olds with only a high school diploma. In addition, there is a significant median earnings gap between men and women in the U.S. workforce.  For example, for workers with a high school degree, the wage gap between men and women is about $8,800, or 43 percent of the average earnings for women.  While some scholars have found that programs’ gender composition has only a small effect on earnings threshold pass rates after accounting for other factors such as whether the program is offered by a for-profit school, others have raised concerns that gender-based wage disparities could figure prominently in program failures.    

However, the data suggest that cosmetology programs’ poor track record of setting students up for success can’t be entirely ascribed to gender.  We find that the gender-based wage disparity within the cosmetology field is comparatively small, and not even in favor of men:  one year after completing their programs, female graduates of cosmetology programs earn 13 percent more than male graduates of the same programs earn.  

```{r figure2, include=TRUE, echo=FALSE, warning=FALSE}

######################################################################
### First we load in a new set of variables from the program-level ###
### College Scorecard dataset.                                     ###
######################################################################

CSP3 <- fread("Most-Recent-Cohorts-Field-of-Study.csv", header=TRUE, select=c(
  "UNITID",                   # Unit ID for institution
  "OPEID6",                   # 6-digit OPE ID for institution
  "CONTROL",                  # Control of institution
  "CIPCODE",                  # Classification of Instructional Programs (CIP) code for the field of study
  "CREDLEV",                  # Level of credential
  "EARN_MALE_WNE_MDN_1YR",    # Median earnings of male graduates working and not enrolled 1 year after completing highest credential
  "EARN_NOMALE_WNE_MDN_1YR",  # Median earnings of non-male graduates working and not enrolled 1 year after completing highest credential
  "EARN_COUNT_MALE_WNE_1YR",  # Number of male graduates working and not enrolled 1 year after completing highest credential
  "EARN_COUNT_NOMALE_WNE_1YR" # Number of non-male graduates working and not enrolled 1 year after completing highest credential
)) 

######################################################################
### Next we filter for the programs where there is data on both    ###
### men's and women's earnings. (The dataset uses "male" and "non- ###
### male," which for simplicity we refer to here as female.)       ###
######################################################################

CSP3 <- CSP3 %>% filter((EARN_MALE_WNE_MDN_1YR %in% c("NULL", "PrivacySuppressed"))==FALSE) %>% filter((EARN_NOMALE_WNE_MDN_1YR %in% c("NULL", "PrivacySuppressed"))==FALSE) 

######################################################################
### Now we make sure the earnings data are in numerics.            ###
######################################################################

CSP3$EARN_COUNT_MALE_WNE_1YR <- as.numeric(CSP3$EARN_COUNT_MALE_WNE_1YR) 
CSP3$EARN_COUNT_NOMALE_WNE_1YR <- as.numeric(CSP3$EARN_COUNT_NOMALE_WNE_1YR) 
CSP3$EARN_MALE_WNE_MDN_1YR <- as.numeric(CSP3$EARN_MALE_WNE_MDN_1YR)
CSP3$EARN_NOMALE_WNE_MDN_1YR <- as.numeric(CSP3$EARN_NOMALE_WNE_MDN_1YR)

######################################################################
### We're interested in four fields of study here. We make a new   ###
### dataframe for each, filtered for only the programs in that     ###
### field.                                                         ###
######################################################################

CSP3.cos <- CSP3 %>% filter(CIPCODE=="1204")
CSP3.edu <- CSP3 %>% filter(CIPCODE=="1301")
CSP3.den <- CSP3 %>% filter(CIPCODE=="5106")
CSP3.nur <- CSP3 %>% filter(CIPCODE=="5138")
CSP3.all <- CSP3

######################################################################
### Now, for both the male set of variables and the female set of  ###
### variables, we find each program's share of the total students. ###
######################################################################

CSP3.cos$maleshare <- CSP3.cos$EARN_COUNT_MALE_WNE_1YR / sum(CSP3.cos$EARN_COUNT_MALE_WNE_1YR)
CSP3.edu$maleshare <- CSP3.edu$EARN_COUNT_MALE_WNE_1YR / sum(CSP3.edu$EARN_COUNT_MALE_WNE_1YR)
CSP3.den$maleshare <- CSP3.den$EARN_COUNT_MALE_WNE_1YR / sum(CSP3.den$EARN_COUNT_MALE_WNE_1YR)
CSP3.nur$maleshare <- CSP3.nur$EARN_COUNT_MALE_WNE_1YR / sum(CSP3.nur$EARN_COUNT_MALE_WNE_1YR)
CSP3.all$maleshare <- CSP3.all$EARN_COUNT_MALE_WNE_1YR / sum(CSP3.all$EARN_COUNT_MALE_WNE_1YR)

CSP3.cos$femaleshare <- CSP3.cos$EARN_COUNT_NOMALE_WNE_1YR / sum(CSP3.cos$EARN_COUNT_NOMALE_WNE_1YR)
CSP3.edu$femaleshare <- CSP3.edu$EARN_COUNT_NOMALE_WNE_1YR / sum(CSP3.edu$EARN_COUNT_NOMALE_WNE_1YR)
CSP3.den$femaleshare <- CSP3.den$EARN_COUNT_NOMALE_WNE_1YR / sum(CSP3.den$EARN_COUNT_NOMALE_WNE_1YR)
CSP3.nur$femaleshare <- CSP3.nur$EARN_COUNT_NOMALE_WNE_1YR / sum(CSP3.nur$EARN_COUNT_NOMALE_WNE_1YR)
CSP3.all$femaleshare <- CSP3.all$EARN_COUNT_NOMALE_WNE_1YR / sum(CSP3.all$EARN_COUNT_NOMALE_WNE_1YR)

######################################################################
### Then we multiply each program's median earnings values by the  ###
### corresponding share of the universe of students.               ###
######################################################################

CSP3.cos$weightedmedian.male <- CSP3.cos$maleshare * CSP3.cos$EARN_MALE_WNE_MDN_1YR
CSP3.edu$weightedmedian.male <- CSP3.edu$maleshare * CSP3.edu$EARN_MALE_WNE_MDN_1YR
CSP3.den$weightedmedian.male <- CSP3.den$maleshare * CSP3.den$EARN_MALE_WNE_MDN_1YR
CSP3.nur$weightedmedian.male <- CSP3.nur$maleshare * CSP3.nur$EARN_MALE_WNE_MDN_1YR
CSP3.all$weightedmedian.male <- CSP3.all$maleshare * CSP3.all$EARN_MALE_WNE_MDN_1YR

CSP3.cos$weightedmedian.female <- CSP3.cos$femaleshare * CSP3.cos$EARN_NOMALE_WNE_MDN_1YR
CSP3.edu$weightedmedian.female <- CSP3.edu$femaleshare * CSP3.edu$EARN_NOMALE_WNE_MDN_1YR
CSP3.den$weightedmedian.female <- CSP3.den$femaleshare * CSP3.den$EARN_NOMALE_WNE_MDN_1YR
CSP3.nur$weightedmedian.female <- CSP3.nur$femaleshare * CSP3.nur$EARN_NOMALE_WNE_MDN_1YR
CSP3.all$weightedmedian.female <- CSP3.all$femaleshare * CSP3.all$EARN_NOMALE_WNE_MDN_1YR

######################################################################
### Lastly we generate weighted median values, put them in a       ###
### new dataframe, and create a barchart.                          ###
######################################################################

tblMW <- data.frame("CIP" = rep(c("Cosmetology",
                                  "Education (general)",
                                  "Dental assistant",
                                  "Nursing", 
                                  "All fields"), 2), 
                     "Gender" = c(rep("Men", 5), rep("Women", 5)), 
                     "Earnings" = c(sum(CSP3.cos$weightedmedian.male), 
                                    sum(CSP3.edu$weightedmedian.male), 
                                    sum(CSP3.den$weightedmedian.male), 
                                    sum(CSP3.nur$weightedmedian.male), 
                                    sum(CSP3.all$weightedmedian.male),
                                    sum(CSP3.cos$weightedmedian.female), 
                                    sum(CSP3.edu$weightedmedian.female), 
                                    sum(CSP3.den$weightedmedian.female), 
                                    sum(CSP3.nur$weightedmedian.female), 
                                    sum(CSP3.all$weightedmedian.female)))
tblMW$CIP <- factor(tblMW$CIP, levels=c("Cosmetology", "Dental assistant", "Education (general)", "Nursing", "All fields"))
ggplot(data=tblMW, mapping=aes(x=CIP, y=Earnings, color=Gender)) + geom_bar(stat="identity", position = position_dodge2(padding=0.1), fill="white") + labs(x="Field of study", y="Average earnings of workers 1 year after program completion") + scale_y_continuous(labels=scales::dollar_format()) + scale_color_manual(values=c("blue", "red"))
```

Cosmetology programs are atypical - when all postsecondary programs are included, women graduates earn 12 percent less than men who completed the same program.

```{r stat17, include=TRUE, echo=FALSE, warning=FALSE}

#######################################################################
### Here we simply find the ratio of cosmetology programs' weighted ### 
### median earnings for women versus their weighted median earnings ###
### for men.                                                        ###
#######################################################################

ratio1 <- (sum(CSP3.cos$weightedmedian.female) / sum(CSP3.cos$weightedmedian.male)) - 1
paste("Women earn just ", percent(abs(ratio1)), " less than male graduates of their cosmetology programs.")
```

Accordingly, even if cosmetology programs had the same gender composition as the general population, it is likely that programs’ overall earnings would not be significantly higher: in fact, they may be lower. Because male graduates of cosmetology programs see poor earnings just like female graduates, the quality of education in these programs and the dearth of good-paying cosmetology jobs must play a greater role in cosmetology program’s Gainful Employment failures than gender representation.   

### The proposed rule appropriately factors in the earnings of all program graduates, even those with no income.

Critics of the earnings threshold have also suggested that the earnings threshold, as described by the department during the negotiated rulemaking process, would unfairly compare earnings from all program graduates (including those with zero income) to workers with only a high school diploma (excluding those with zero incomes).  However, including non-working program graduates while excluding non-working high school graduates is justified.  Students who invest time and money and go into debt to pursue a career-focused postsecondary degree do so in order to pursue a career in that field.  Graduates of such programs who are not working are likely to be unsuccessfully seeking employment, rather than choosing to remain outside of the labor force.  Accordingly, it is appropriate to compare all program graduates to workers with only a high school diploma.

## Will cosmetology programs meet the new rule’s debt-to-earnings benchmark?

A larger percentage of cosmetology programs will meet the debt-to-earnings threshold than meet the high school earnings threshold:  72 percent of cosmetology programs subject to the rule pass the threshold without any adjustments.  

```{r stat18, include=TRUE, echo=FALSE, warning=FALSE}

#######################################################################
### This is a simple percentage calculation.                        ###
#######################################################################

passing.share <- sum(GEP.cos.DTE$count[GEP.cos.DTE$pfDTE=="Pass - based on GE data"]) / sum(GEP.cos.DTE$count)
paste(percent(passing.share), " of cosmetology programs subject to the DTE rule pass.")
```

(See Figure 3 below.) 

```{r figure3, include=TRUE, echo=FALSE, warning=FALSE}

#######################################################################
### To graph programs'  outcomes for the DTE test, we first         ###
### calculate each program's discretionary earnings rate and annual ###
### earnings rate.                                                  ###
#######################################################################

GEP.cos.DTE$discretionaryEarningsRate <- GEP.cos.DTE$annual_loan_payment_plus / (GEP.cos.DTE$earn_ne_mdn_3yr - 18735)
GEP.cos.DTE$annualEarningsRate <- GEP.cos.DTE$annual_loan_payment_plus / GEP.cos.DTE$earn_ne_mdn_3yr

#######################################################################
### Here I modify the pass/fail indicator for aesthetic purposes.   ###
#######################################################################

GEP.cos.DTE$`Pass/Fail` <- ifelse(GEP.cos.DTE$pfDTE=="Fail - based on GE Data", "Fail", "Pass")

#######################################################################
### For aesthetic purposes, we remove programs where the typical    ###
### annnual loan payment is $0.                                     ###
#######################################################################

GEP.cos.DTE2 <- GEP.cos.DTE %>% filter(annual_loan_payment_plus != 0)

#######################################################################
### Now we plot median earnings and the annual loan payment.        ###
#######################################################################

fig3 <- ggplot(data=GEP.cos.DTE2, mapping=aes(x=earn_ne_mdn_3yr, y=annual_loan_payment_plus)) + geom_point(aes(shape=`Pass/Fail`), alpha=0.6, size=3) 

#######################################################################
### Next we add a line indicating the annual earnings threshold.    ###
#######################################################################

fig3 <- fig3 + geom_abline(slope=0.08, intercept=0, color="blue", linetype="dashed") 

#######################################################################
### Next we add a line indicating the discretionary earnings        ###
### threshold.                                                      ###
#######################################################################

fig3 <- fig3 + geom_abline(slope=0.2, intercept= -3747, color="orange", linetype="dashed") 

#######################################################################
### Finally we perform some formatting.                             ###
#######################################################################

fig3 <- fig3 + scale_y_continuous(lim=c(0, 3000), labels=scales::dollar_format()) + scale_x_continuous(lim=c(0, 32000), labels=scales::dollar_format()) + labs(x="Median annual earnings 3 years after program completion", y="Annual loan payment", caption="Programs located above both the blue line and the orange line fail the debt-to-earnings test") + scale_shape_manual(values = c(4, 1))

fig3
```

If the earnings rate is adjusted by adding 8 percent to address concerns about underreported income, then 78 percent of cosmetology programs pass the debt-to-earnings test.  

```{r stat19, include=TRUE, echo=FALSE, warning=FALSE}
paste("This was calculated earlier in the paper.")
```

Of programs that fail the debt-to-earnings threshold, virtually all (98 percent) are for-profit programs.  Only two programs pass the earnings test but fail the debt-to-earnings metric.   

```{r stat20, include=TRUE, echo=FALSE, warning=FALSE}

#######################################################################
### After we isolate DTE fails, this is a simple percentage         ###
### calculation.                                                    ###
#######################################################################

GEP.cos.DTE.fails <- GEP.cos.DTE %>% filter(pfDTE=="Fail - based on GE Data")
FP.ratio <- sum(GEP.cos.DTE.fails$count[GEP.cos.DTE.fails$control=="Private, for-profit"]) / sum(GEP.cos.DTE.fails$count)
paste("Of programs that fail the DTE test, ", percent(FP.ratio), " are at for-profits.")
```

A program fails the debt-to-earnings requirement if more than half of the students on financial aid have high debt relative to their total earnings and high debt relative to their earnings after protecting a certain amount for basic living expenses. The first test asks whether the standard payment on the student loans would be more than 8 percent of median income three years after program completion. In Figure 3 above, this is represented by the blue line. The second test asks whether the payment would be more than 20 percent of discretionary income, defined as earnings above 150% of the poverty line, currently $18,735. This is represented by the orange line above.  Most cosmetology programs pass the first debt-to-earnings test, which compares annual loan payment with median income.  However, almost all cosmetology programs fail the second debt-to-earnings test: their annual loan payment is more than 20 percent of discretionary income.  Programs have to fail both the debt-to-earnings tests to fail the Gainful Employment rule.  

Even though there is only a small percentage of cosmetology programs that pass the earnings threshold but fail the debt-to-earnings threshold, the debt-to-earnings threshold should still be retained.  It is not enough for programs to raise earnings above high school graduates’ earnings - to be worthwhile, a program must also enable graduates to earn enough to pay back their student loans.  Including the debt-to-earnings metric ensures that students are not taking on debt that they will be unable to repay.  It also creates strong incentives for schools to decrease tuition.  Accordingly, both measures should be retained in the new rule.            

## The new rule will lead to significant changes for the industry that will benefit students.

With nearly all cosmetology programs at risk of failing the new Gainful Employment rule, it is likely that the rule will cause a major upheaval for the industry.  Some cosmetology programs that lose Title IV funding may close their doors.  Others may be able to pivot to operating without Title IV funding.  A significant proportion of cosmetology programs currently operate without participating in Title IV.  Cosmetology programs that do not receive Title IV funding tend to be less expensive and accordingly, may be a better deal for students.  A study that compared for-profit cosmetology programs that received Title IV funding with similar-length programs that did not participate in Title IV and found that the non-Title IV programs were significantly less expensive than for-profit cosmetology programs that participate in Title IV: on average the tuition for non-Title IV programs was $3,900 less than the tuition of Title IV participating programs.  Not only did the Title IV participating cosmetology schools charge higher tuition than the non-Title IV programs, but the price differential was roughly the same as the amount of federal aid dollars provided for each student, suggesting that participation in Title IV may have caused for-profit schools to inflate tuition above the cost of education.  The Title IV and non-Title IV programs had passage rates for state licensure exams.   

While non-Title IV programs offered by for-profit schools may be less expensive than Title IV programs, the programs are still risky for students.  Even with somewhat cheaper tuition, cosmetology students are unlikely to be able to pay for programs without taking on at least some debt.  Without access to federal grants and loans, some students could turn to private student loans or other forms of consumer debt.  Private student loans and other forms of consumer debt generally have higher interest rates and many fewer protections than federal student debt.  In addition, students in some states may be able to pursue free or very low-cost cosmetology training through apprenticeship programs.  Several states, including California, Maryland, and Wyoming currently offer small-scale cosmetology apprenticeship programs funded through the federal Workforce Innovation and Opportunity Act (“WIOA”).  States should consider instituting or expanding opportunities to obtain training in cosmetology through such programs.  

## Recommendations 

* The Department of Education should move forward with the proposed Gainful Employment rule that includes both a debt-to-earnings and a high school earnings threshold.  The Gainful Employment rule will prevent students  and taxpayers from wasting resources on programs that provide little or no benefit.   
* The Department of Education should also move forward with a rule that would limit Title IV eligibility by program length. The program length rule will drive states to decrease inflated minimum hour requirements, lowering costs and reducing students’ borrowing.  In addition, the department should consider limiting or prohibiting schools from profiting from students’ unpaid labor. 
* States should also take steps to protect cosmetology students, including reducing inflated minimum hour requirements for cosmetology licensure, expanding apprenticeship programs, and limiting or prohibiting schools from profiting from students’ unpaid students.
